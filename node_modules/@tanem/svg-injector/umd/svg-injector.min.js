!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.SVGInjector=e()}(this,function(){"use strict";var i=function(t){return t.cloneNode(!0)},a={},o=[],l=function(t,e){o[t]=o[t]||[],o[t].push(e)},s=function(r,t){for(var e=0,n=o[r].length;e<n;e++)!function(e){setTimeout(function(){var t=o[r][e];a[r]instanceof SVGSVGElement?t(null,i(a[r])):a[r]instanceof Error&&t(a[r])},0)}(e)},j="http://www.w3.org/1999/xlink",M=[],T={},V=0,d=function(S,x,t,E,k){var e=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),G=S.getAttribute("data-src")||S.getAttribute("src");if(/\.svg/i.test(G))if(e)-1===M.indexOf(S)&&(M.push(S),S.setAttribute("src",""),function(r,t){var n="file:"===window.location.protocol;if(void 0!==a[r]){if(a[r]instanceof SVGSVGElement)return t(null,i(a[r]));if(a[r]instanceof Error)return t(a[r]);l(r,t)}else{if(!window.XMLHttpRequest)return t(new Error("Browser does not support XMLHttpRequest"));a[r]={},l(r,t);var o=new XMLHttpRequest;o.onreadystatechange=function(){try{if(4===o.readyState){if(404===o.status||null===o.responseXML)throw new Error(n?"Note: SVG injection ajax calls do not work locally without adjusting security setting in your browser. Or consider using a local webserver.":"Unable to load SVG file: "+r);if(!(200===o.status||n&&0===o.status))throw new Error("There was a problem injecting the SVG: "+o.status+" "+o.statusText);if(o.responseXML instanceof Document)a[r]=o.responseXML.documentElement;else if(DOMParser&&DOMParser instanceof Function){var e;try{e=(new DOMParser).parseFromString(o.responseText,"text/xml")}catch(t){e=void 0}if(!e||e.getElementsByTagName("parsererror").length)throw new Error("Unable to parse SVG file: "+r);a[r]=e.documentElement}s(r)}}catch(t){a[r]=t,s(r)}},o.open("GET",r),o.overrideMimeType&&o.overrideMimeType("text/xml"),o.send()}}(G,function(t,c){if(t)return k(t),!1;var e=S.getAttribute("id");e&&c.setAttribute("id",e);var r=S.getAttribute("title");r&&c.setAttribute("title",r);var n=[].concat(c.getAttribute("class")||[],"injected-svg",S.getAttribute("class")||[]).join(" ");c.setAttribute("class",function(t){for(var e={},r=(t=t.split(" ")).length,n=[];r--;)e.hasOwnProperty(t[r])||(e[t[r]]=1,n.unshift(t[r]));return n.join(" ")}(n));var o=S.getAttribute("style");o&&c.setAttribute("style",o);var i=[].filter.call(S.attributes,function(t){return/^data-\w[\w-]*$/.test(t.name)});if(Array.prototype.forEach.call(i,function(t){t.name&&t.value&&c.setAttribute(t.name,t.value)}),E){var f,p,d,v,h,w={clipPath:["clip-path"],"color-profile":["color-profile"],cursor:["cursor"],filter:["filter"],linearGradient:["fill","stroke"],marker:["marker","marker-start","marker-mid","marker-end"],mask:["mask"],pattern:["fill","stroke"],radialGradient:["fill","stroke"]};Object.keys(w).forEach(function(t){d=w[f=t];for(var e=0,r=(p=c.querySelectorAll("defs "+f+"[id]")).length;e<r;e++){var n;v=p[e].id,h=v+"-"+V,Array.prototype.forEach.call(d,function(t){for(var e=0,r=(n=c.querySelectorAll("["+t+'*="'+v+'"]')).length;e<r;e++)n[e].setAttribute(t,"url(#"+h+")")});for(var o=c.querySelectorAll("[*|href]"),i=[],a=0,l=o.length;a<l;a++)o[a].getAttributeNS(j,"href").toString()==="#"+p[e].id&&i.push(o[a]);for(var s=0,u=i.length;s<u;s++)i[s].setAttributeNS(j,"href","#"+h);p[e].id=h}})}c.removeAttribute("xmlns:a");for(var a,l,s=c.querySelectorAll("script"),u=[],g=0,m=s.length;g<m;g++)(l=s[g].getAttribute("type"))&&"application/ecmascript"!==l&&"application/javascript"!==l||(a=s[g].innerText||s[g].textContent,u.push(a),c.removeChild(s[g]));if(0<u.length&&("always"===x||"once"===x&&!T[G])){for(var b=0,y=u.length;b<y;b++)new Function(u[b])(window);T[G]=!0}var A=c.querySelectorAll("style");Array.prototype.forEach.call(A,function(t){t.textContent+=""}),c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("xmlns:xlink",j),S.parentNode.replaceChild(c,S),delete M[M.indexOf(S)],V++,k(S=null,c)}));else{var r=S.getAttribute("data-fallback")||S.getAttribute("data-png");r?(S.setAttribute("src",r),k()):t?(S.setAttribute("src",t+"/"+G.split("/").pop().replace(".svg",".png")),k()):k(new Error("This browser does not support SVG and no PNG fallback was defined."))}else k(new Error("Attempted to inject a file with a non-svg extension: "+G))};return function(r,t,n){var e=void 0===t?{}:t,o=e.evalScripts,i=void 0===o?"always":o,a=e.pngFallback,l=void 0!==a&&a,s=e.each,u=void 0===s?function(){}:s,c=e.renumerateIRIElements,f=void 0===c||c;if(void 0===n&&(n=function(){}),void 0!==r.length){var p=0;Array.prototype.forEach.call(r,function(t){d(t,i,l,f,function(t,e){u(t,e),r.length===++p&&n(p)})})}else r?d(r,i,l,f,function(t,e){u(t,e),n(1),r=null}):n(0)}});
